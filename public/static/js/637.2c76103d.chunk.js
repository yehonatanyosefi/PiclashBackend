"use strict";(self.webpackChunkpiclash=self.webpackChunkpiclash||[]).push([[637],{3757:function(e,t,r){r.r(t),r.d(t,{default:function(){return J}});var n=r(5076),s=r(3433),a=r(1413),o=r(4165),c=r(5861),u=r(9439),i=r(2791),l=r(9434),d=(r(2211),r(3869));var p=r(1176),f=(r(276),r(1243)),m="/api/",h=f.Z.create({withCredentials:!0}),v={get:function(e,t){return x(e,"GET",t)},post:function(e,t){return x(e,"POST",t)},put:function(e,t){return x(e,"PUT",t)},delete:function(e,t){return x(e,"DELETE",t)}};function x(e){return g.apply(this,arguments)}function g(){return g=(0,c.Z)((0,o.Z)().mark((function e(t){var r,n,s,a=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"GET",n=a.length>2&&void 0!==a[2]?a[2]:null,e.prev=2,e.next=5,h({url:"".concat(m).concat(t),method:r,data:n,params:"GET"===r?n:null});case 5:return s=e.sent,e.abrupt("return",s.data);case 9:throw e.prev=9,e.t0=e.catch(2),console.log("Had Issues ".concat(r,"ing to the backend, endpoint: ").concat(t,", with data:"),n),console.dir(e.t0),e.t0.response&&401===e.t0.response.status&&sessionStorage.clear(),e.t0;case 15:case"end":return e.stop()}}),e,null,[[2,9]])}))),g.apply(this,arguments)}var y="ai/";function b(e){return j.apply(this,arguments)}function j(){return(j=(0,c.Z)((0,o.Z)().mark((function e(t){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.post(y+"genImg",{prompt:t});case 3:return r=e.sent,e.abrupt("return",r);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error posting image: ".concat(e.t0)),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function k(){return k=(0,c.Z)((0,o.Z)().mark((function e(t,r,n){var s,a,c,u,i,l,d,f=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=f.length>3&&void 0!==f[3]?f[3]:"",a=n.username,c="Guest"===a?"Made by: ".concat(s,", "):"",e.prev=3,u="".concat(t,", ").concat(r),e.next=7,b(u);case 7:return i=e.sent,l="AI, ".concat(c,'With the prompt: "').concat(t,'". Category: ').concat(r,"."),e.next=11,p.W.createPost(n,l,i);case 11:return d=e.sent,e.abrupt("return",{imgUrl:i,postId:d});case 15:throw e.prev=15,e.t0=e.catch(3),console.error("Error creating post with Dall E: ".concat(e.t0)),e.t0;case 19:case"end":return e.stop()}}),e,null,[[3,15]])}))),k.apply(this,arguments)}var Z={createPostWithAiImg:function(e,t,r){return k.apply(this,arguments)}},w=r(5849),I=r(406),N=r(2685),P="aKKGgYXK0NXjHcKgAgWmRkUKQ9M2",C="room",R={createRoom:function(e,t,r){return E.apply(this,arguments)},joinRoom:function(e,t){return S.apply(this,arguments)},startGame:function(e){return T.apply(this,arguments)}};function E(){return E=(0,c.Z)((0,o.Z)().mark((function e(t,r,n){var s,a,c,u,i,l,p,f,m=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=m.length>3&&void 0!==m[3]?m[3]:"",a=(0,N.iH)(d.yG,"".concat(C,"/").concat(t)),e.next=4,(0,N.U2)(a);case 4:if((c=e.sent).exists()){e.next=10;break}u={id:t,category:w.Y.getRndCategory(),players:[{userId:n,nickname:s}],guests:n===P?1:0,votes:{},posts:[],status:"pending"},(0,N.t8)(a,u).then((function(){r(U(u))})),e.next=19;break;case 10:if(i=c.val(),l=i.players.includes(n),p=n===P,l&&!p){e.next=18;break}return l||i.players.push(n),p&&(i.guests+=1),e.next=18,(0,N.t8)(a,i);case 18:r(U(i));case 19:return f=(0,N.jM)(a,(function(e){r(U(e.val()))})),e.abrupt("return",f);case 21:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function S(){return S=(0,c.Z)((0,o.Z)().mark((function e(t,r){var n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,N.iH)(d.yG,"".concat(C,"/").concat(t)),e.next=3,(0,N.jM)(n,function(){var e=(0,c.Z)((0,o.Z)().mark((function e(t){var s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.exists()){e.next=8;break}return(s=t.val()).players||(s.players=[]),s.players.push(r),e.next=6,(0,N.t8)(n,s);case 6:e.next=9;break;case 8:console.error("The specified room does not exist");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function T(){return T=(0,c.Z)((0,o.Z)().mark((function e(t){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,N.iH)(d.yG,"".concat(C,"/").concat(t)),e.next=3,(0,N.jM)(r,function(){var e=(0,c.Z)((0,o.Z)().mark((function e(t){var n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.exists()){e.next=11;break}if(!((n=t.val()).players.length>=3)){e.next=8;break}return n.gameStarted=!0,e.next=6,(0,N.t8)(r,n);case 6:e.next=9;break;case 8:console.error("A minimum of 3 players are required to start the game");case 9:e.next=12;break;case 11:console.error("The specified room does not exist");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}function U(e){return function(){var t=(0,c.Z)((0,o.Z)().mark((function t(r,n){var s;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{s={type:I.wq,room:e},r(s)}catch(n){console.log("error:",n)}case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}var G=r(184);function M(e){var t=e.onClick,r=e.children,n=e.disabled,s=void 0!==n&&n;return(0,G.jsx)("button",{onClick:t,disabled:s,className:"w-full flex justify-center bg-blue-medium text-white px-4 py-2 rounded-lg transition-colors duration-200 ".concat(s?"bg-gray-400 cursor-not-allowed":"hover:bg-blue-light"),children:r})}function O(e){var t=e.createImgWithAi,r=e.nickname,n=e.handleNickChange,s=e.loggedInUser,a=e.prompt,o=e.handlePromptChange,c=e.MAX_PROMPT_LENGTH;return(0,G.jsxs)("form",{onSubmit:t,className:"space-y-4",children:["Guest"===(null===s||void 0===s?void 0:s.username)&&(0,G.jsx)("input",{type:"text",name:"nickname",value:r,placeholder:"Enter nickname here",onChange:function(e){return n(e)},className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,G.jsx)("input",{type:"text",placeholder:"Enter your prompt here",onChange:function(e){return o(e,c)},value:a,className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,G.jsx)(M,{type:"submit",children:"Submit"})]})}function A(e){var t=e.setRoomId,r=e.utilService;return(0,G.jsxs)("div",{children:[(0,G.jsx)("p",{className:"text-gray-600 mb-2",children:"Or create a new room:"}),(0,G.jsx)(M,{onClick:function(){return t(r.makeRoomId())},children:"Create Room"})]})}function _(e){var t=e.inputRoomId,r=e.setInputRoomId,n=e.joinRoom;return(0,G.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,G.jsx)("input",{type:"text",value:t,onChange:function(e){return r(e.target.value)},placeholder:"Enter room ID to join",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-gray-500 focus:ring-2 focus:ring-blue-500"}),(0,G.jsx)(M,{onClick:n,children:"Join"})]})}function H(e){var t=e.roomId,r=e.room,n=e.numberOfPlayers;return(0,G.jsxs)("div",{className:"text-center space-y-2 mb-6",children:[(0,G.jsxs)("h2",{className:"text-blue-500 text-2xl font-bold",children:["Room #",t]}),(0,G.jsxs)("h3",{className:"text-blue-500 text-xl",children:["Category: ",null===r||void 0===r?void 0:r.category]}),"started"===(null===r||void 0===r?void 0:r.status)&&(0,G.jsx)("h3",{className:"text-blue-500 text-xl",children:"Game has started!"}),"pending"===(null===r||void 0===r?void 0:r.status)&&n<3&&(0,G.jsxs)("p",{className:"text-gray-600",children:["Wait for more people to join, current people in the room: ",n,"/3"]}),"pending"===(null===r||void 0===r?void 0:r.status)&&n>=3&&(0,G.jsxs)("p",{className:"text-gray-600",children:["Current people in the room: ",n]})]})}function L(e){var t=e.numberOfPlayers,r=e.startGameRoom,n=e.room,s=t<e.MIN_PEOPLE_TO_START||"pending"!==(null===n||void 0===n?void 0:n.status);return(0,G.jsx)("div",{className:"mb-4",children:!s&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("p",{className:"text-gray-600",children:"You can start the game!"}),(0,G.jsx)(M,{onClick:r,disabled:s,children:"Start"})]})})}function V(e){var t=e.imgUrl,r=e.prompt;return(0,G.jsx)("div",{className:"mb-4",children:t&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("p",{className:"text-gray-600 mb-2",children:"Your Image:"}),(0,G.jsx)("div",{className:"rounded-lg overflow-hidden shadow-lg",children:(0,G.jsx)("img",{className:"object-cover w-full h-64",src:t,alt:r})})]})})}var W=r(1088),D=function(e){var t=e.post,r=e.handleVote;return(0,G.jsxs)("div",{className:"space-y-2",children:[(0,G.jsx)("img",{src:t.imgUrl,alt:"Post by ".concat(t.nickname),className:"w-full h-auto rounded-lg"}),(0,G.jsx)(M,{onClick:function(){return r(t.id)},children:"Vote for this image"})]},t.id)},F=function(e){var t=e.posts,r=e.votes;return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("p",{children:"Thank you for voting!"}),(0,G.jsx)("p",{children:"Leaderboard"}),(0,G.jsx)("div",{className:"grid grid-cols-2 gap-4",children:t.map((function(e){var t;return(0,G.jsxs)("div",{className:"space-y-2",children:[(0,G.jsx)("img",{src:e.imgUrl,alt:"Post by ".concat((null===e||void 0===e?void 0:e.nickname)||"a user"),className:"w-full h-auto rounded-lg"}),(0,G.jsxs)("div",{className:"flex items-center",children:[(0,G.jsx)(W.Z,{iconName:"like"}),(0,G.jsx)("span",{className:"ml-2",children:(null===r||void 0===r||null===(t=r.filter((function(t){return t.postId===e.id})))||void 0===t?void 0:t.length)||0})]})]},e.id)}))})]})};function K(e){var t=e.hasVoted,r=e.handleVote,n=e.room,s=e.nickname,a=e.loggedInUser,o=e.GUEST_ID;if(t)return(0,G.jsx)(F,{posts:n.posts,votes:n.votes});var c=(0,i.useMemo)((function(){var e;return(null===n||void 0===n||null===(e=n.posts)||void 0===e?void 0:e.length)&&n.posts.filter((function(e){return function(e,t,r,n){return e.userId===n?t.nickname!==r:e.userId!==t.userId}(a,e,s,o)}))||[]}),[n,a,s,o]);return 0===c.length?null:(0,G.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,G.jsx)("p",{children:"Select the image you want to vote for:"}),c.map((function(e){return(0,G.jsx)(D,{post:e,handleVote:r},e.id)}))]})}var Y=100,X=3;function q(){var e,t=(0,l.v9)((function(e){return e.userModule.loggedInUser})),r=(0,l.v9)((function(e){return e.roomModule.room}));console.log("room:",r);var n=(0,l.v9)((function(e){return e.roomModule.unsubscribe})),p=(0,l.I0)(),f=(0,i.useState)(""),m=(0,u.Z)(f,2),h=m[0],v=m[1],x=(0,i.useState)(""),g=(0,u.Z)(x,2),y=g[0],b=g[1],j=(0,i.useState)(""),k=(0,u.Z)(j,2),E=k[0],S=k[1],T=(0,i.useState)(""),U=(0,u.Z)(T,2),M=U[0],W=U[1],D=(0,i.useState)(""),F=(0,u.Z)(D,2),q=F[0],J=F[1],Q=(0,i.useState)(!1),z=(0,u.Z)(Q,2),B=z[0],$=z[1],ee=(0,i.useState)(null),te=(0,u.Z)(ee,2),re=te[0],ne=te[1],se=(null===r||void 0===r||null===(e=r.players)||void 0===e||e.includes(P),(null===t||void 0===t?void 0:t.userId)===P),ae=(null===r||void 0===r?void 0:r.votes)||[],oe=!1;ae.length>0&&(oe=se?ae.some((function(e){return(null===e||void 0===e?void 0:e.nickname)===E})):ae.some((function(e){return e.userId===t.userId})));var ce=(null===r||void 0===r?void 0:r.guests)||1;function ue(){return(ue=(0,c.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ce>=X)){e.next=3;break}return e.next=3,le({status:"started"});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return(ie=(0,c.Z)((0,o.Z)().mark((function e(r){var n,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!oe&&t){e.next=2;break}return e.abrupt("return");case 2:return n={userId:t.userId,nickname:E},c=(0,a.Z)((0,a.Z)({},n),{},{postId:r}),e.next=6,le({votes:[].concat((0,s.Z)(ae),[c])});case 6:return e.next=8,updatePostVotes(r,n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){return de.apply(this,arguments)}function de(){return(de=(0,c.Z)((0,o.Z)().mark((function e(t){var n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r&&void 0!==r&&r.id){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n=(0,N.iH)(d.yG,"".concat(C,"/").concat(r.id)),e.next=6,(0,N.i3)(n,(function(e){return e&&(e=(0,a.Z)((0,a.Z)({},e),t)),e}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("Failed to update room",e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function pe(){return(pe=(0,c.Z)((0,o.Z)().mark((function e(n){var s,a,c,u,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),t){e.next=3;break}return e.abrupt("return");case 3:if(s=E.replace(/\b\w/g,(function(e){return e.toUpperCase()})),!r.players.some((function(e){return e.userId===t.userId&&se&&s===e.nickname}))){e.next=6;break}return e.abrupt("return",ne("Nickname already exists"));case 6:if(!(s.length>=20)){e.next=8;break}return e.abrupt("return",ne("Nickname must be less than 20 characters"));case 8:return ne(null),$(!0),e.prev=10,e.next=13,Z.createPostWithAiImg(h,r.category,t,s);case 13:if(a=e.sent,c=a.imgUrl,u=a.postId,!c){e.next=25;break}return(i=r.posts||[]).push({prompt:h,imgUrl:c,userId:null===t||void 0===t?void 0:t.userId,uppercaseNick:s,id:u}),e.next=21,le({posts:i});case 21:v(""),b(c),e.next=26;break;case 25:ne("AI service failed to return an image URL.");case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(10),console.log("err:",e.t0),e.t0.response?ne(e.t0.response.data):ne(e.t0.message);case 32:return e.prev=32,$(!1),e.finish(32);case 35:case"end":return e.stop()}}),e,null,[[10,28,32,35]])})))).apply(this,arguments)}return(0,i.useEffect)((function(){var e=null===t||void 0===t?void 0:t.userId;if(e&&M)return null!==r&&void 0!==r&&r.id&&!M&&W(r.id),p(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return function(){var n=(0,c.Z)((0,o.Z)().mark((function n(s,a){var c,u;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,R.createRoom(e,s,t,r);case 3:c=n.sent,u={type:I.q3,unsubscribe:c},s(u),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.log("error:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e,t){return n.apply(this,arguments)}}()}(M,e,E)),function(){n&&n()}}),[M]),(0,G.jsxs)("div",{className:"bg-gray-background flex flex-col items-center justify-center px-4 py-8",children:[B&&(0,G.jsx)("div",{className:"bg-gray-200 p-2 rounded-lg text-center",children:"Loading..."}),re&&(0,G.jsx)("div",{className:"bg-red-200 p-2 rounded-lg text-center",children:JSON.stringify(re)}),M&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(H,{roomId:M,room:r,numberOfPlayers:ce}),(0,G.jsx)(L,{room:r,numberOfPlayers:ce,startGameRoom:function(){return ue.apply(this,arguments)},MIN_PEOPLE_TO_START:X}),"started"===(null===r||void 0===r?void 0:r.status)&&!y&&!B&&(0,G.jsx)(O,{createImgWithAi:function(e){return pe.apply(this,arguments)},nickname:E,handleNickChange:function(e){var t=e.target.value;S(t)},loggedInUser:t,prompt:h,handlePromptChange:function(e){var t=e.target.value;t.length<=Y?v(t):v(t.slice(0,Y))},MAX_PROMPT_LENGTH:Y}),(0,G.jsx)(K,{loggedInUser:t,GUEST_ID:P,nickname:E,hasVoted:oe,handleVote:function(e){return ie.apply(this,arguments)},room:r,numberOfPlayers:ce}),(0,G.jsx)(V,{imgUrl:y,prompt:h})]}),!M&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(_,{inputRoomId:q,setInputRoomId:J,joinRoom:function(){W(q)}}),(0,G.jsx)(A,{setRoomId:W,utilService:w.Y})]})]})}function J(){return(0,G.jsx)(n.Z,{children:(0,G.jsxs)("div",{className:"flex flex-col items-center justify-center mt-20",children:[(0,G.jsx)("h1",{className:"text-4xl font-bold",children:"PicClash"}),(0,G.jsx)(q,{})]})})}}}]);
//# sourceMappingURL=637.2c76103d.chunk.js.map